#jinja2: trim_blocks: True, lstrip_blocks: True
# {{ ansible_managed }}
# Generated from 'elasticsearch.application.rules' group
# Do not change in-place! In order to change this file first read following link:
# https://git.daimler.com/CCP/platform-infrastructure/tree/master/scripts/prometheus-rules-generator.py
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: "elasticsearch.application.rules"
  namespace: {{ k8s_namespace }}
spec:
{% if not prometheus_rules.elasticsearch %}
  groups: []
{% else %}
  groups:
  - name: elasticsearch.application.rules
    rules:
    - expr: |-
        elasticsearch_thread_pool_active_count{job=~"elasticsearch.*"}
        /
        elasticsearch_thread_pool_threads_count{job=~"elasticsearch.*"} >= 0
      record: :elasticsearch_threadpool_utilisation:ratio
    - expr: |-
        sum without (host, name, instance, type) (
          elasticsearch_thread_pool_active_count{job=~"elasticsearch.*"}
        )
        /
        sum without (host, name, instance, type) (
          elasticsearch_thread_pool_threads_count{type="write", job=~"elasticsearch.*"}
        ) >= 0
      record: :elasticsearch_cluster_threadpool_utilisation:ratio
{% endif %}
