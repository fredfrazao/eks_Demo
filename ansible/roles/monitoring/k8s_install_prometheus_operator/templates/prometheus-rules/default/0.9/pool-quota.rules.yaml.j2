#jinja2: trim_blocks: True, lstrip_blocks: True
# {{ ansible_managed }}
# Generated from 'pool-quota.rules' group
# Do not change in-place! In order to change this file first read following link:
# https://git.daimler.com/CCP/platform-infrastructure/tree/master/scripts/prometheus-rules-generator.py
---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: "pool-quota.rules"
  namespace: {{ k8s_namespace }}
spec:
{% if not prometheus_rules.ceph %}
  groups: []
{% else %}
  groups:
  - name: pool-quota.rules
    rules:
    - alert: CephPoolQuotaBytesNearExhaustion
      annotations:
    {% raw %}
        description: Storage pool {{ $labels.name }} quota usage has crossed 70%.
    {% endraw %}
        message: Storage pool quota(bytes) is near exhaustion.
        severity_level: warning
        storage_type: ceph
      expr: (ceph_pool_stored_raw * on (pool_id) group_left(name)ceph_pool_metadata) / ((ceph_pool_quota_bytes * on (pool_id) group_left(name)ceph_pool_metadata) > 0) > 0.70
      for: 1m
      labels:
        severity: warning
        notify_team: {{ prometheus_alert_teams.ceph }}
    - alert: CephPoolQuotaBytesCriticallyExhausted
      annotations:
    {% raw %}
        description: Storage pool {{ $labels.name }} quota usage has crossed 90%.
    {% endraw %}
        message: Storage pool quota(bytes) is critically exhausted.
        severity_level: critical
        storage_type: ceph
      expr: (ceph_pool_stored_raw * on (pool_id) group_left(name)ceph_pool_metadata) / ((ceph_pool_quota_bytes * on (pool_id) group_left(name)ceph_pool_metadata) > 0) > 0.90
      for: 1m
      labels:
        severity: critical
        notify_team: {{ prometheus_alert_teams.ceph }}
{% endif %}
